Metadata-Version: 2.4
Name: itl-k8s-oidc
Version: 0.1.0
Summary: Automates Kubernetes auth via Keycloak OIDC
Author-email: ITlusions <contact@itlusions.com>
License: MIT
Project-URL: Homepage, https://github.com/ITlusions/ITLAuth
Project-URL: Repository, https://github.com/ITlusions/ITLAuth
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: click>=8.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: requests>=2.25.0

# ITLAuth

ITL Kubernetes OIDC Authentication Setup Package

This package automates Kubernetes authentication via Keycloak OIDC for ITlusions infrastructure.

## Features

- üîß **Automated Setup**: Checks kubectl, installs krew and oidc-login plugin automatically
- üîê **Secure Authentication**: Uses public OIDC client with PKCE for secure authentication
- ‚öôÔ∏è **Flexible Configuration**: Supports CLI arguments, environment variables, and config files
- üåê **Device Code Support**: Optional device code flow for headless or restricted environments
- üîí **Custom CA Support**: Handle custom certificate authorities
- üìù **Kubeconfig Integration**: Works with custom kubeconfig paths
- ‚úÖ **Auth Verification**: Optional kubectl auth whoami verification

## Installation

```bash
pip install itl-k8s-oidc
```

## Quick Start

### Basic Usage (ITlusions Default)

```bash
itl-oidc-setup
```

This uses the default ITlusions Keycloak issuer: `https://auth.itlusions.com/realms/itlusions`

### Custom Issuer

```bash
itl-oidc-setup --issuer-url https://my-keycloak.example.com/realms/myrealm
```

### Device Code Flow

```bash
itl-oidc-setup --use-device-code
```

### Custom CA and Kubeconfig

```bash
itl-oidc-setup --custom-ca /path/to/ca.crt --kubeconfig ~/.kube/prod-config
```

### With Authentication Verification

```bash
itl-oidc-setup --verify-auth --verbose
```

## Configuration

Configuration can be provided via:

1. **CLI Arguments** (highest precedence)
2. **Environment Variables** 
3. **Configuration File**
4. **Default Values** (lowest precedence)

### Environment Variables

- `OIDC_ISSUER_URL`: Override the default issuer URL
- `OIDC_CLIENT_ID`: Override the default client ID
- `OIDC_USE_DEVICE_CODE`: Set to "true" to enable device code flow
- `OIDC_CA_PATH`: Path to custom CA certificate
- `KUBECONFIG`: Path to kubeconfig file
- `OIDC_VERIFY_AUTH`: Set to "true" to enable auth verification

### Configuration File

Create a configuration file at one of these locations:
- `~/.itl-oidc.yaml`
- `~/.config/itl-oidc/config.yaml`
- `./itl-oidc.yaml` (current directory)

Example configuration file:

```yaml
oidc:
  issuer_url: "https://auth.itlusions.com/realms/itlusions"
  client_id: "kubernetes"
  use_device_code: false
  verify_auth: false
```

See `itl-oidc.yaml.example` for a complete example.

## CLI Reference

```
Usage: itl-oidc-setup [OPTIONS]

Options:
  -i, --issuer-url TEXT        OIDC issuer URL
  -c, --client-id TEXT         OIDC client ID (default: kubernetes)
  -d, --use-device-code        Use device code flow for authentication
  --ca, --custom-ca PATH       Path to custom CA certificate file
  -k, --kubeconfig PATH        Path to kubeconfig file
  -v, --verify-auth            Verify authentication after setup
  -f, --config-file PATH       Path to configuration file
  --verbose                    Enable verbose output
  --version                    Show version and exit
  --help                       Show this message and exit
```

## What This Tool Does

1. **Checks kubectl**: Verifies kubectl is installed and accessible
2. **Installs krew**: Downloads and installs the kubectl plugin manager if not present
3. **Installs oidc-login**: Installs the kubectl oidc-login plugin via krew
4. **Configures OIDC**: Runs `kubectl oidc-login setup` with your configuration
5. **Verifies Setup**: Optionally runs `kubectl auth whoami` to verify authentication

## Requirements

- Python 3.8+
- kubectl (will be checked by the tool)
- Internet connection (for downloading krew and plugins)

## Development

### Setup Development Environment

```bash
git clone https://github.com/ITlusions/ITLAuth.git
cd ITLAuth
pip install -e .
```

### Run Tests

```bash
python -m pytest tests/
```

## License

MIT License
