# Example Service Account Configuration

# Configuration file for service accounts
# Used by automation scripts and token managers

keycloak:
  server: "https://sts.itlusions.com"
  realm: "itlusions"
  admin_realm: "master"

service_accounts:
  monitoring-sa:
    client_id: "monitoring-sa"
    client_secret: "${MONITORING_SA_SECRET}"  # Use environment variable
    description: "Service account for monitoring and metrics collection"
    permissions:
      - "pods:get,list,watch"
      - "services:get,list,watch"
      - "nodes:get,list,watch"
    
  backup-sa:
    client_id: "backup-sa"
    client_secret: "${BACKUP_SA_SECRET}"
    description: "Service account for backup operations"
    permissions:
      - "pods:get,list"
      - "persistentvolumes:get,list"
      - "persistentvolumeclaims:get,list"
    
  ci-cd-sa:
    client_id: "ci-cd-sa"
    client_secret: "${CI_CD_SA_SECRET}"
    description: "Service account for CI/CD pipeline automation"
    permissions:
      - "deployments:get,list,create,update,patch"
      - "services:get,list,create,update,patch"
      - "configmaps:get,list,create,update,patch"
      - "secrets:get,list,create,update,patch"
    
  logging-sa:
    client_id: "logging-sa"
    client_secret: "${LOGGING_SA_SECRET}"
    description: "Service account for log collection and processing"
    permissions:
      - "pods:get,list,watch"
      - "pods/log:get"
      - "events:get,list,watch"

# RBAC configuration templates
rbac_templates:
  monitoring:
    cluster_role: |
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: monitoring-reader
      rules:
      - apiGroups: [""]
        resources: ["pods", "services", "nodes", "endpoints"]
        verbs: ["get", "list", "watch"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets", "daemonsets"]
        verbs: ["get", "list", "watch"]
      - apiGroups: ["metrics.k8s.io"]
        resources: ["pods", "nodes"]
        verbs: ["get", "list"]
    
    cluster_role_binding: |
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: monitoring-sa-binding
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: monitoring-reader
      subjects:
      - apiGroup: rbac.authorization.k8s.io
        kind: Group
        name: monitoring-group

  backup:
    cluster_role: |
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: backup-operator
      rules:
      - apiGroups: [""]
        resources: ["pods", "persistentvolumes", "persistentvolumeclaims"]
        verbs: ["get", "list"]
      - apiGroups: [""]
        resources: ["pods/exec"]
        verbs: ["create"]
      - apiGroups: ["snapshot.storage.k8s.io"]
        resources: ["volumesnapshots", "volumesnapshotcontents"]
        verbs: ["get", "list", "create", "delete"]
    
    cluster_role_binding: |
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: backup-sa-binding
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: backup-operator
      subjects:
      - apiGroup: rbac.authorization.k8s.io
        kind: Group
        name: backup-group